<div class="container mx-auto px-4" *ngIf="!loading">
  <!-- Header Section -->
  <div *ngIf="distributor" class="mt-3 mb-4">
    <div class="flex items-center gap-3 mb-2">
      <img
        class="w-[38px] h-[38px] border border-primary dark:border-neutral-600 bg-neutral-100 dark:bg-neutral-700 p-[1px] rounded-full"
        onError="this.src='assets/images/avatar.svg'"
        [src]="
          distributor.distributor_image
            ? distributor.distributor_image
            : 'assets/images/avatar.svg'
        "
        alt=""
      />
      <h2 class="text-xl font-primary font-medium text-neutral-800 dark:text-neutral-200 mb-0">
        Good Morning, {{ distributor.distributor_name }}
      </h2>
    </div>
    <p class="m-0 block font-primary text-neutral-500 dark:text-neutral-300">
      Here's what's happening at
      <strong class="font-medium text-neutral-900 dark:text-neutral-300">{{
        distributor.distributor_name
      }}.</strong>
    </p>
  </div>

  <!-- KPI Cards Row -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
    <!-- Today's Booking Card -->
    <div class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative overflow-hidden shadow-[0_0_5px_#0000001a]">
      <div class="relative z-10">
        <h2 class="text-xl uppercase tracking-wide font-primary font-medium text-gray-900 dark:text-white relative pl-4">
          <span class="absolute left-0 top-[6px] w-0.5 h-4 bg-primary"></span>
          Today's <span class="font-light">Booking</span>
        </h2>
        <div class="px-4 text-4xl text-primary dark:text-neutral-200 font-['Rationale',sans-serif] pb-4 pt-5 mb-4 border-b border-gray-200 dark:border-[#333333] relative overflow-hidden [background-image:url(/assets/images/kpi-achive-img.jpg)] dark:[background-image:url(/assets/images/kpi-achive-img-dark.jpg)] bg-[length:auto] bg-[position:right_bottom] bg-no-repeat" 
       >
          <span class="text-secondary dark:text-gray-300">Rs.</span>
          {{ homeReport?.today_sale | decimal }}
        </div>
        <div class="grid grid-cols-4 gap-3 text-sm px-4">
          <div class="text-gray-600 dark:text-gray-400">
            Pending Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReport?.pending_sale | decimal }}
            </span>
          </div>
          <div class="text-gray-600 dark:text-gray-400">
            Spot Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReport?.spot_sale | decimal }}
            </span>
          </div>
          <div class="text-gray-600 dark:text-gray-400">
            Counter Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReport?.counter_sale | decimal }}
            </span>
          </div>
          <div class="text-gray-600 dark:text-gray-400">
            Net Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{
                (homeReport?.pending_sale || 0) +
                  (homeReport?.spot_sale || 0) +
                  (homeReport?.counter_sale || 0) | decimal
              }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Sale Trends Card -->
    <div class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative overflow-hidden shadow-[0_0_5px_#0000001a]">
      <div class="relative z-10">
        <h2 class="text-xl uppercase tracking-wide font-primary font-medium text-gray-900 dark:text-white relative pl-4">
          <span class="absolute left-0 top-[6px] w-0.5 h-4 bg-primary"></span>
          Monthly <span class="font-light">Sale Trends</span>
        </h2>
        <div class="px-4 text-4xl text-primary dark:text-neutral-300 font-['Rationale',sans-serif] pb-4 pt-5 mb-4 border-b border-gray-200 dark:border-[#333333] relative overflow-hidden [background-image:url(/assets/images/kpi-achive-img.jpg)] dark:[background-image:url(/assets/images/kpi-achive-img-dark.jpg)] bg-[length:auto] bg-[position:right_bottom] bg-no-repeat" 
        >
          <span class="text-secondary dark:text-gray-300">Rs.</span>
          {{ homeReportMonthly?.monthly_sale | decimal }}
        </div>
        <div class="grid grid-cols-3 gap-3 text-sm px-4">
          <div class="text-gray-600 dark:text-gray-400">
            Pending Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReportMonthly?.pending_sale | decimal }}
            </span>
          </div>
          <div class="text-gray-600 dark:text-gray-400">
            Spot Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReportMonthly?.spot_sale | decimal }}
            </span>
          </div>
          <div class="text-gray-600 dark:text-gray-400">
            Counter Sale
            <span class="block text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mt-1">
              <small class="text-primary dark:text-neutral-400 text-base">Rs.</small>
              {{ homeReportMonthly?.counter_sale | decimal }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Stock & Market Credit Row -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- Current Stock Card -->
    <div class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative overflow-hidden shadow-[0_0_5px_#0000001a] [background-image:url(/assets/images/distributor-bg.jpg)] dark:[background-image:url(/assets/images/distributor-bg-dark.jpg)] bg-[length:auto] bg-[position:right_top] bg-no-repeat">
      <div class="relative z-10 h-full flex flex-col justify-between">
        <h2 class="text-lg pl-4 font-primary font-medium text-primary dark:text-neutral-200 mb-4 leading-none">
          Current <span class="font-normal text-secondary dark:text-gray-300">Stock</span>
        </h2>
        <div class="flex items-end justify-between px-4">
          <div class="text-2xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] ml-auto mr-6">
            <small class="text-primary dark:text-neutral-400">QTY:</small>
            {{ homeReportMonthly?.distributor_sellable_qty | decimal }}
            <span class="text-lg">CTNs</span>
          </div>
          <h2 class="text-3xl text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mb-0">
            <small class="text-primary dark:text-neutral-400 text-xl">Rs.</small>
            {{ homeReportMonthly?.distributor_gross_value | decimal }}
          </h2>
        </div>
      </div>
    </div>

    <!-- Market Credit Card -->
    <div class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative overflow-hidden shadow-[0_0_5px_#0000001a] [background-image:url(/assets/images/distributor-bg.jpg)] dark:[background-image:url(/assets/images/distributor-bg-dark.jpg)] bg-[length:auto] bg-[position:right_top] bg-no-repeat">
      <div class="relative z-10 h-full flex flex-col justify-between">
        <h2 class="text-lg pl-4 font-primary font-medium text-primary dark:text-neutral-200 mb-4 leading-none">
          Market <span class="font-normal text-secondary dark:text-gray-300">Credit</span>
        </h2>
        <h2 class="text-3xl mr-4 text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none mb-0 text-right">
          <small class="text-primary dark:text-neutral-400 text-xl">Rs.</small>
          {{ homeReportMonthly?.retailer_credits | decimal }}
        </h2>
      </div>
    </div>
  </div>

  <!-- Top 5 Booked Products -->
  <div class="mb-6">
    <h2 class="text-xl font-primary font-medium text-secondary dark:text-gray-400 mb-4 pb-2 border-b-2 border-neutral-200 dark:border-[#333333]">
      Top 5 <span class="font-light">Booked Products</span>
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
      <ng-container *ngFor="let product of homeReport?.products_sold; let i = index">
        <div
          *ngIf="i < 5"
          class="bg-white dark:bg-[#1a1a1a] border border-gray-200 dark:border-[#1e1e1e] rounded-lg  shadow-[0_0_5px_#0000001a] hover:shadow-[0_0_15px_#00000033] dark:hover:shadow-[0_0_15px_#ffffff1a] transition-all duration-300 hover:scale-[1.02] relative overflow-hidden">
        <!-- Blue accent bar -->
        <div class="absolute left-0 top-[13px] w-0.5 h-[18px] bg-primary"></div>
        
        <h3 class="text-sm font-primary font-medium text-gray-900 dark:text-white mb-2 line-clamp-2 min-h-[42px] pl-4 mt-3">
          {{ product.item_name }}
        </h3>
        
        <div class="flex items-center justify-center mb-2">
          <img
            [src]="product.thumbnail"
            [alt]="product.item_name"
            class="object-cover m-auto custum-size-home rounded-lg"
          />
        </div>
        
        <div class="rounded-lg p-0 text-center">
          <div class="border-b border-primary dark:border-primary pb-1">
            <span class="text-primary dark:text-neutral-400 text-base font-primary">
              <small class="text-sm">Rs. </small>
              <span class="text-xl font-['Rationale',sans-serif]">{{ product.item_trade_price | decimal }}</span>
            </span>
          </div>
          <div class="grid grid-cols-2 gap-2 text-gray-600 dark:text-gray-400 text-sm pb-[8px] pt-[8px]">
            <div class="pl-4">
              <span class="block text-lg text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none">
                {{ product.ctns_booked }}
                <small class="text-[14px]">{{ product.unit_name }}</small>
              </span>
              Booked
            </div>
            <div class="pr-4">
              <span class="block text-lg text-secondary dark:text-gray-300 font-['Rationale',sans-serif] leading-none">
                {{ product.available_qty }}
                <small class="text-[14px]">{{ product.unit_name }}</small>
              </span>
              Available
            </div>
          </div>
        </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Shortcuts Section -->
  <div class="mb-6">
    <h2 class="text-xl font-primary font-medium text-secondary dark:text-gray-400 mb-4 pb-2 border-b-2 border-neutral-200 dark:border-[#333333]">
      Shortcuts <span></span>
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <a
        [routerLink]="['/orders', 'counter-sale']"
        class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative shadow-[0_0_5px_#0000001a] hover:shadow-[0_0_10px_#0000001a] overflow-hidden transition-all duration-200 hover:scale-[1.02] h-[165px] shortcut-card-bg group">
        <div class="absolute left-0 bottom-[22px] w-0.5 h-[38px] bg-primary"></div>
        <div class="absolute top-2.5 right-2.5">
          <img src="assets/images/add-stock-01.svg" alt="" class="w-[55px] h-[55px] dark:[filter:invert(1)_grayscale(1)]" />
        </div>
        <h2 class="absolute bottom-[15px] left-[15px] text-lg font-primary font-medium text-gray-900 dark:text-white mb-0 pb-1 tracking-wide group-hover:text-primary dark:group-hover:text-neutral-100 transition-colors">
          Add <span class="font-light text-gray-600 dark:text-gray-400 block text-sm">Counter Sale</span>
        </h2>
      </a>

      <a
        [routerLink]="['/inventory', 'distributor-purchase']"
        class="bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative shadow-[0_0_5px_#0000001a] hover:shadow-[0_0_10px_#0000001a] overflow-hidden transition-all duration-200 hover:scale-[1.02] h-[165px] shortcut-card-bg group">
        <div class="absolute left-0 bottom-[22px] w-0.5 h-[38px] bg-primary"></div>
        <div class="absolute top-2.5 right-2.5">
          <img src="assets/images/add-order.svg" alt="" class="w-[55px] h-[55px]  dark:[filter:invert(1)_grayscale(1)]" />
        </div>
        <h2 class="absolute bottom-[15px] left-[15px] text-lg font-primary font-medium text-gray-900 dark:text-white mb-0 pb-1 tracking-wide group-hover:text-primary dark:group-hover:text-neutral-100 transition-colors">
          Add<span class="font-light text-gray-600 dark:text-gray-400 block text-sm">Stock Purchase</span>
        </h2>
      </a>

      <a
        [routerLink]="['/orders']"
        class="block bg-white dark:bg-[#141414] dark:border-[#1e1e1e] border rounded-lg pt-4 pb-4 relative shadow-[0_0_5px_#0000001a] hover:shadow-[0_0_10px_#0000001a] overflow-hidden transition-all duration-200 hover:scale-[1.02] h-[165px] shortcut-card-bg group">
        <div class="absolute left-0 bottom-[22px] w-0.5 h-[38px] bg-primary"></div>
        <div class="absolute top-2.5 right-2.5">
          <img src="assets/images/dispatch-order.svg" alt="" class="w-[55px] h-[55px]  dark:[filter:invert(1)_grayscale(1)]" />
        </div>
        <h2 class="absolute bottom-[15px] left-[15px] text-lg font-primary font-medium text-gray-900 dark:text-white mb-0 pb-1 tracking-wide group-hover:text-primary dark:group-hover:text-neutral-100 transition-colors">
          View<span class="font-light text-gray-600 dark:text-gray-400 block text-sm">Booking</span>
        </h2>
      </a>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="container mx-auto px-4">
  <div class="flex justify-center items-center pt-[11vh] pb-[7vh]">
    <app-loader-white></app-loader-white>
  </div>
</div>
