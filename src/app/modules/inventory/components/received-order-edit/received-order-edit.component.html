<div class="container mx-auto px-4 pb-24">
  <div class="mt-3 mb-3">
    <div class="flex justify-between items-center text-left">
      <div>
        <h1
          class="text-lg text-secondary dark:text-gray-400 font-primary font-medium mb-0"
        >
          Received<span class="font-light"> Order</span>
        </h1>
      </div>
      <div></div>
    </div>
  </div>

  <div
    class="bg-white dark:bg-[#1f1f1f] border-t-[3px] border-primary p-4 rounded-lg relative shadow-[0_0_5px_#0000001a] dark:shadow-[0_0_5px_rgba(255,255,255,0.05)]"
  >
    <div *ngIf="loading" class="flex justify-center items-center py-12">
      <app-loader-white></app-loader-white>
    </div>

    <div *ngIf="!loading">
      <div
        class="flex flex-wrap items-center gap-3 mb-3 border-b border-gray-200 dark:border-[#333333] pb-3"
      >
        <div
          class="flex w-[280px] justify-between items-center bg-[#f9f9f9] dark:bg-[#141414] border-b border-[#d1d1d1] dark:border-[#1d1d1d] px-3 py-2 leading-none rounded-md"
        >
          <strong
            class="text-gray-900 dark:text-gray-300 font-primary font-medium"
            >Order ID:</strong
          >
          <span
            class="font-[Rationale,sans-serif] text-[#0038ba] dark:text-neutral-200 text-[16px]"
            >{{ order?.id }}</span
          >
        </div>
        <div
          class="flex w-[280px] justify-between items-center bg-[#f9f9f9] dark:bg-[#141414] border-b border-[#d1d1d1] dark:border-[#1d1d1d] px-3 py-2 leading-none rounded-md"
        >
          <strong
            class="text-gray-900 dark:text-gray-300 font-primary font-medium"
            >Date:</strong
          >
          <span
            class="font-[Rationale,sans-serif] text-[#0038ba] dark:text-neutral-200 text-[16px]"
            >{{ order?.date }}</span
          >
        </div>
        <div
          class="flex w-[280px] justify-between items-center bg-[#f9f9f9] dark:bg-[#141414] border-b border-[#d1d1d1] dark:border-[#1d1d1d] px-3 py-2 leading-none rounded-md"
        >
          <strong
            class="text-gray-900 dark:text-gray-300 font-primary font-medium"
            >Distributor:</strong
          >
          <span
            class="font-[Rationale,sans-serif] text-[#0038ba] dark:text-neutral-200 text-[16px]"
            >{{ order?.distributor_name }}</span
          >
        </div>
      </div>

      <div
        class="rounded-md border-primary bg-white dark:bg-[#1f1f1f] shadow-sm transition-colors duration-200"
      >
        <table
          class="table table-hover dt-responsive nowrap table_order w-full"
          id="example"
          style="width: 100%"
        >
          <thead class="bg-gray-50 dark:bg-[#141414]">
            <tr>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                SKU
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left w-[250px]"
              >
                Item Name
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Prim. Qty
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Unit Quantity
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Received Unit Qty.
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                T.P
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                GR.Amt
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                T.O
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Dist.Disc%
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Extra Disc
              </th>

              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                GST
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                AIT
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Total Bill
              </th>
              <th
                class="text-[13px] font-primary font-medium text-neutral-900 dark:text-gray-200 px-1.5 py-1.5 text-left"
              >
                Action
              </th>
            </tr>
          </thead>

          <tfoot class="bg-gray-50 dark:bg-[#141414] text-[13px]">
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Total items:
              </th>
              <th
                class="order_total_items font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ totalItems }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Gross Amount.
              </th>
              <th
                class="order_gross_amount font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ totalGrossAmount | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Order Discount.
              </th>
              <th
                class="order_total_discount font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                - {{ totalDiscount | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Subtotal PKR.
              </th>
              <th
                class="order_sub_total font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ subTotalPlusFreight | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Frieght Price.
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5 text-left">
                {{ freight_price | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>

            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Subtotal PKR.
              </th>
              <th
                class="order_sub_total_af_FP font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ subTotalPlusFreight | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Tax.
              </th>
              <th
                class="order_tax font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ totalTax | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
            <tr class="border-t border-gray-200 dark:border-[#333333]">
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
              <th
                class="font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                Total PKR.
              </th>
              <th
                class="order_grand_total font-primary font-medium text-gray-800 dark:text-gray-300 px-1.5 py-1.5 text-left"
              >
                {{ totalPKR | number : "1.2-2" }}
              </th>
              <th class="font-primary font-medium px-1.5 py-1.5"></th>
            </tr>
          </tfoot>

          <tbody class="bg-white dark:bg-[#1f1f1f]">
            <tr
              *ngIf="!items || items.length === 0"
              class="border-t border-gray-200 dark:border-[#333333]"
            >
              <td colspan="12" class="text-center py-8">
                <p class="text-gray-500 dark:text-gray-400">
                  Add products to order...
                </p>
              </td>
            </tr>
            <tr
              *ngFor="let item of items; let index = index"
              class="border-t border-gray-200 dark:border-[#333333] hover:bg-[#ededed] dark:hover:bg-[#2a2a2a] transition-colors duration-150"
            >
              <td
                class="text-[13px] text-gray-800 dark:text-gray-200 px-1.5 py-1.5"
              >
                {{ item.item_sku }}
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-200 px-1.5 py-1.5"
              >
                {{ item.item_name }}
              </td>
              <td class="px-1.5 py-1.5">
                {{ item.primary_qty_sold | number : "1.2-2" }}

                <span
                  *ngIf="item.schemeFreeProdsCount"
                  class="text-[13px] text-green-600 dark:text-green-400 font-semibold block mt-1"
                >
                  +{{ item.schemeFreeProdsCount }}
                </span>
              </td>
              <td class="px-1.5 py-1.5">
                {{ item.parent_qty_sold | number : "1.2-2" }}

                <span
                  *ngIf="item.schemeFreeProdsCount"
                  class="text-[13px] text-green-600 dark:text-green-400 font-semibold block mt-1"
                >
                  +{{ item.schemeFreeProdsCount }}
                </span>
              </td>
              <td class="px-1.5 py-1.5">
                <input
                  type="number"
                  min="0"
                  [max]="item.parent_qty_sold"
                  placeholder="0"
                  class="w-[80px] h-[26px] px-2 py-1 text-[13px] border border-gray-300 dark:border-[#434343] rounded bg-white dark:bg-[#141414] text-gray-900 dark:text-white focus:outline-none focus:border-primary"
                  [(ngModel)]="item.received_unit_quantity"
                  (input)="onReceivedUnitChange(item, $event)"
                />
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5"
              >
                {{
                  item.unit_item_trade_price || item.parent_tp
                    | number : "1.2-2"
                }}
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5"
              >
                {{ item._calc_gross_amount || 0 | number : "1.2-2" }}
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5"
                [ngClass]="{
                  'text-green-600 dark:text-green-400 font-semibold':
                    item.scheme_quantity_free > 0,
                  'text-gray-800 dark:text-gray-300':
                    item.scheme_quantity_free <= 0
                }"
              >
                {{
                  item.scheme_id &&
                  item.scheme_type == "free_product" &&
                  (item._calc_scheme_free || 0) > 0 &&
                  item.scheme_rule === 4
                    ? "(" + (item._calc_scheme_free || 0) + ")"
                    : ""
                }}
                {{
                  item.scheme_id &&
                  item.scheme_type == "free_product" &&
                  item.scheme_rule === 1
                    ? (item._calc_trade_offer || 0 | number : "1.2-2")
                    : ""
                }}
                {{
                  item.scheme_id && item.scheme_type == "dotp"
                    ? (item._calc_trade_offer || 0 | number : "1.2-2")
                    : ""
                }}
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5"
              >
                {{ item.distributor_discount | number : "1.2-2" }}
              </td>

              <td class="px-1.5 py-1.5">
                {{ item.booker_discount | number : "1.2-2" }}
              </td>

              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5"
              >
                {{ item._calc_gst_tax || 0 | number : "1.2-2" }}
              </td>
              <td
                class="text-[13px] text-gray-300 dark:text-gray-300 px-1.5 py-1.5"
              >
                {{ item._calc_ait_tax || 0 | number : "1.2-2" }}
              </td>
              <td
                class="text-[13px] text-gray-800 dark:text-gray-300 px-1.5 py-1.5 font-medium"
              >
                {{ item._calc_total_bill || 0 | number : "1.2-2" }}
              </td>
              <td class="px-1.5 py-1.5">
                <button
                  type="button"
                  (click)="deleteOrderItem(item.item_id)"
                  class="px-1.5 py-1.5 text-[11px] leading-none rounded-[5px] font-primary bg-red-600 text-white hover:bg-red-700 focus:outline-none transition-colors"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="mt-4 bg-gray-50 dark:bg-[#151515] border border-gray-200 dark:border-[#333333] rounded-lg p-4 flex justify-center gap-3"
      >
        <button
          type="button"
          (click)="save()"
          class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:outline-none transition-colors flex items-center gap-2"
          [disabled]="saving"
        >
          {{ saving ? "Saving..." : "Save" }}
        </button>
        <button
          type="button"
          (click)="cancel()"
          class="px-6 py-2 leading-none text-[13px] rounded-[5px] font-primary border border-primary dark:border-[#717171] bg-transparent text-primary dark:text-white dark:opacity-70 hover:bg-red-600 hover:border-red-600 dark:hover:border-red-600 hover:text-white focus:bg-red-600 focus:border-red-600 focus:text-white transition-colors"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
