<!-- Print Bills Modal - Tailwind CSS with Light/Dark Mode -->
<div
  *ngIf="showBillsModal"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-4"
  (click)="closeBillsModal()"
>
  <div 
    class="bg-white dark:bg-darkprimary rounded-lg shadow-xl w-full max-w-2xl mx-auto border-t-4 border-t-primary"
    (click)="$event.stopPropagation()"
  >
    <!-- Modal Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-[#333333]">
      <h5 class="text-lg font-semibold text-gray-900 dark:text-white font-primary">
        Print bill for this order
      </h5>
      <button
        type="button"
        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
        (click)="closeBillsModal()"
        aria-label="Close"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="px-6 py-5">
      <h2 class="text-base font-medium text-gray-800 dark:text-gray-200 mb-6 font-primary">
        Select paper size for print
      </h2>
      
      <div class="grid grid-cols-2 gap-4">
        <!-- A4 Option -->
        <button
          (click)="getBills('A4')"
          class="group flex flex-col items-center p-6 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-[#0038ba] dark:hover:border-[#4d7fff] hover:shadow-lg transition-all duration-200 bg-white dark:bg-[#1f1f1f]"
        >
          <img
            class="w-12 h-12 mb-4 opacity-70 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0"
            src="assets/images/a4.svg"
            alt="A4 Paper"
          />
          <strong class="text-sm text-gray-800 dark:text-gray-200 group-hover:text-[#0038ba] dark:group-hover:text-[#4d7fff] transition-colors">
            A4 Portrait Paper
          </strong>
        </button>

        <!-- A5 Option -->
        <button
          (click)="getBills('A5')"
          class="group flex flex-col items-center p-6 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-[#0038ba] dark:hover:border-[#4d7fff] hover:shadow-lg transition-all duration-200 bg-white dark:bg-[#1f1f1f]"
        >
          <img
            class="w-12 h-12 mb-4 opacity-70 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0"
            src="assets/images/a5.svg"
            alt="A5 Paper"
          />
          <strong class="text-sm text-gray-800 dark:text-gray-200 group-hover:text-[#0038ba] dark:group-hover:text-[#4d7fff] transition-colors">
            A5 Landscape Paper
          </strong>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Unit, Quantity and Trade Offer of Products - Tailwind Modal -->
<div
  id="exampleModal"
  *ngIf="showQuantityModal"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-4"
  (click)="closeQuantityModal($event)"
>
  <div 
    class="bg-white dark:bg-darkprimary rounded-lg shadow-xl w-full max-w-lg mx-auto border-t-4 border-t-primary"
    (click)="$event.stopPropagation()"
  >
    <!-- Modal Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-[#333333]">
      <h5 class="text-lg font-semibold text-gray-900 dark:text-white font-primary">
        Product <span class="font-light text-gray-600 dark:text-gray-400">Detail</span>
        </h5>
        <button
          type="button"
        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors dont-close-products"
          (click)="closeQuantityModal($event)"
          aria-label="Close"
        >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        </button>
      </div>

    <!-- Modal Body -->
      <div
        *ngIf="selectedProduct.hasOwnProperty('quantity')"
      class="px-6 py-5 space-y-4"
    >
      <!-- Product Name -->
      <div class="flex flex-col sm:flex-row sm:items-start gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32 flex-shrink-0">Product:</label>
        <div class="text-sm text-gray-900 dark:text-white font-primary flex-1">
          {{selectedProduct.item_name}}
        </div>
      </div>

      <!-- SKU -->
      <div class="flex flex-col sm:flex-row sm:items-start gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32 flex-shrink-0">SKU:</label>
        <div class="text-sm text-gray-900 dark:text-white font-primary flex-1">
          {{selectedProduct.item_sku}}
        </div>
      </div>

      <!-- Add Quantity -->
      <div class="flex flex-col sm:flex-row sm:items-start gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32 flex-shrink-0 pt-2">Add Quantity:</label>
        <div class="flex-1">
            <nz-input-number
            [(ngModel)]="selectedProduct.stockQty"
            #selectedQty="ngModel"
            (ngModelChange)="setQuantity(selectedProduct)"
            [nzMin]="0"
            [nzStep]="1"
            nzPlaceHolder="Enter quantity"
            class="payment-input-number w-full rounded-md focus:border-primary hover:border-primary dont-close-products"
            name="quantity"
            required
          ></nz-input-number>
            <span
              *ngIf="selectedQty.errors?.required && isAdded"
            class="text-red-500 text-xs mt-1 block"
            >
              Please add Quantity!
            </span>
            <span
              *ngIf="
                +selectedProduct.stockQty === 0 &&
                isAdded &&
                !selectedQty.errors?.required
              "
            class="text-red-500 text-xs mt-1 block"
            >
              Quantity should be greater than 0!
            </span>
          </div>
      </div>
           
      <!-- Unit -->
      <div class="flex flex-col sm:flex-row sm:items-start gap-2">
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32 flex-shrink-0">Unit:</label>
        <div class="text-sm text-gray-900 dark:text-white font-primary flex-1">
          {{ selectedProduct.unit_name }}
          </div>
      </div>

      <!-- Trade Offer (Schemes) -->
      <div
        *ngIf="selectedProduct.schemes && selectedProduct.schemes.length"
        class="flex flex-col sm:flex-row sm:items-start gap-2 pt-2"
      >
        <label class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32 flex-shrink-0">Trade Offer:</label>
        <div class="flex-1 space-y-3">
          <div *ngFor="let scheme of selectedProduct.schemes; let i = index" class="flex items-start">
            <div class="flex items-center h-5">
                <input
                  [(ngModel)]="selectedProduct.selectedScheme"
                  (click)="
                    selectedProduct.pref_id &&
                      selectedProduct.stockQty &&
                      calculateProductDiscounts(selectedProduct, scheme)
                  "
                class="w-4 h-4 text-primary bg-white dark:bg-[#141414] border-gray-300 dark:border-[#434343] focus:ring-primary focus:ring-2 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                  type="radio"
                  name="AssignCatalogue"
                  id="byTerritory-{{ i }}"
                  [value]="scheme"
                  [disabled]="checkBundleScheme(scheme,selectedProduct)"
                />
            </div>
            <div class="ml-3 text-sm">
                <label
                class="font-normal text-gray-700 dark:text-gray-300 cursor-pointer"
                  for="byTerritory-{{ i }}"
                >
                {{ scheme.title }} <span class="text-gray-500 dark:text-gray-400">(Min QTy: {{scheme.min_qty}})</span>
              </label>
              </div>
            </div>
          </div>
        </div>
      </div>

    <!-- Modal Footer -->
    <div class="px-6 py-4 bg-gray-50 dark:bg-black border-t border-gray-200 dark:border-[#333333] rounded-b-lg flex justify-end gap-3">
        <button
          type="button"
          id="pl-qty-close"
        class="px-6 py-2 leading-none text-[13px] border border-gray-300 dark:border-[#434343] rounded-[5px] font-primary bg-white dark:bg-[#141414] text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-[#1a1a1a] focus:outline-none focus:ring-2 focus:ring-gray-300 transition-colors dont-close-products"
          (click)="closeQuantityModal($event)"
          aria-label="Close"
        >
          Cancel
        </button>
      <button
        type="submit"
        class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:bg-blue-700 focus:border-blue-700 focus:outline-none focus:ring-2 focus:ring-primary transition-colors dont-close-products"
        (click)="addProductToOrder()"
      >
        Confirm
      </button>
      </div>
    </div>
  </div>

<!-- Credit and Cheque info - Tailwind Modal -->
<div
  id="exampleModal2"
  *ngIf="showPaymentModal"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-4"
  (click)="paymentCancelled()"
>
  <div 
    class="bg-white dark:bg-darkprimary rounded-lg shadow-xl w-full max-w-2xl mx-auto border-t-4 border-t-primary"
    (click)="$event.stopPropagation()"
  >
    <!-- Cheque Modal Header -->
    <div *ngIf="!isCredit" class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-[#333333]">
      <h5 class="text-lg font-semibold text-gray-900 dark:text-white font-primary">
        Add <span class="font-light text-gray-600 dark:text-gray-400">Cheque Information</span>
        </h5>
        <button
          type="button"
        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
          (click)="paymentCancelled()"
          aria-label="Close"
        >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        </button>
      </div>

    <!-- Credit Modal Header -->
    <div *ngIf="isCredit" class="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-[#333333]">
      <h5 class="text-lg font-semibold text-gray-900 dark:text-white font-primary">
        Add <span class="font-light text-gray-600 dark:text-gray-400">Credit Information</span>
      </h5>
      <button
        type="button"
        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"
        (click)="paymentCancelled()"
        aria-label="Close"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Modal Body - Cheque -->
    <div *ngIf="!isCredit" class="px-6 py-5">
      <!-- Payment Type Selection with ng-zorro Radio -->
      <nz-radio-group 
        [(ngModel)]="paymentTypeCheque" 
        (ngModelChange)="onChequePaymentTypeChange()"
        name="paymentTypeCheque"
        class="payment-radio-group flex items-center gap-6 mb-4">
        <label 
          nz-radio 
          nzValue="full"
          class="text-sm font-normal text-gray-700 dark:text-gray-300 cursor-pointer">
          Full Amount
        </label>
        <label 
          nz-radio 
          nzValue="partial"
          class="text-sm font-normal text-gray-700 dark:text-gray-300 cursor-pointer">
          Partial Amount
        </label>
      </nz-radio-group>
      <span
        *ngIf="paymentTypeCheque === '' && isAdded"
        class="text-red-500 text-xs block mb-3"
      >
        Please select a payment method!
      </span>

      <!-- Form Fields with ng-zorro -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Cheque Number -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Cheque Number<span class="text-red-500">*</span>
          </label>
          <input
            nz-input
            type="text"
            id="chequeNum"
            name="cheque_num"
            required
            [(ngModel)]="chequeNumber"
            #chequNo="ngModel"
            placeholder="Enter cheque number"
            class="payment-input rounded-md focus:border-primary hover:border-primary"
          />
          <span
            *ngIf="chequNo.errors?.required && isAdded"
            class="text-red-500 text-xs mt-1 block"
          >
            Please add Cheque Number!
          </span>
        </div>

        <!-- Date with ng-zorro DatePicker -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Date<span class="text-red-500">*</span>
          </label>
          <nz-date-picker
            id="datepicker"
            name="payment_date"
            [(ngModel)]="paymentDate"
            #payDate="ngModel"
            nzPlaceHolder="Select date"
            class="payment-datepicker w-full"
            [nzFormat]="'dd/MM/yyyy'"
          ></nz-date-picker>
          <span *ngIf="!paymentDate && isAdded" class="text-red-500 text-xs mt-1 block">
            Please add Payment Date!
          </span>
        </div>

        <!-- Bank Name -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Bank Name<span class="text-red-500">*</span>
          </label>
          <input
            nz-input
            type="text"
            name="cheque_bank_name"
            id="chequeBankName"
            required
            [(ngModel)]="bankName"
            #bank_Name="ngModel"
            placeholder="Enter bank name"
            class="payment-input rounded-md focus:border-primary hover:border-primary"
          />
          <span
            *ngIf="bank_Name.errors?.required && isAdded"
            class="text-red-500 text-xs mt-1 block"
          >
            Please add Bank Name!
          </span>
        </div>

        <!-- Total Amount with ng-zorro InputNumber -->
        <div *ngIf="paymentTypeCheque !== 'full'">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Total Amount<span class="text-red-500">*</span>
          </label>
          <nz-input-number
            [(ngModel)]="chequeAmount"
            #cheqAmount="ngModel"
            [nzMin]="0"
            [nzMax]="cash?.amount_received"
            [nzStep]="1"
            nzPlaceHolder="Enter amount"
            class="payment-input-number w-full rounded-md focus:border-primary hover:border-primary" 
            id="Amount1"
            name="cheque_amount"
          ></nz-input-number>
          <span
            *ngIf="cheqAmount.errors?.required && isAdded"
            class="text-red-500 text-xs mt-1 block"
          >
            Please add Total Amount!
          </span>
          <span *ngIf="+chequeAmount === 0 && isAdded" class="text-red-500 text-xs mt-1 block">
            Zero value not allowed
          </span>
          <span
            *ngIf="
              !cheqAmount.errors?.required &&
              chequeAmount > cash?.amount_received &&
              isAdded
            "
            class="text-red-500 text-xs mt-1 block"
          >
            Amount should not be greater than
            {{ cash?.amount_received | number: "1.2-2" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Modal Body - Credit -->
    <div *ngIf="isCredit" class="px-6 py-5">
      <!-- Payment Type Selection with ng-zorro Radio -->
      <nz-radio-group 
        [(ngModel)]="paymentTypeCredit"
        (ngModelChange)="onCreditPaymentTypeChange()"
        name="paymentTypeCredit"
        class="payment-radio-group flex items-center gap-6 mb-4">
        <label 
          nz-radio 
          nzValue="full"
          class="text-sm font-normal text-gray-700 dark:text-gray-300 cursor-pointer">
          Full Amount
        </label>
        <label 
          nz-radio 
          nzValue="partial"
          class="text-sm font-normal text-gray-700 dark:text-gray-300 cursor-pointer">
          Partial Amount
        </label>
      </nz-radio-group>
      <span
        *ngIf="paymentTypeCredit === '' && isAdded"
        class="text-red-500 text-xs block mb-3"
      >
        Please select a payment method!
      </span>

      <!-- Amount Field with ng-zorro InputNumber -->
      <div *ngIf="paymentTypeCredit !== 'full'" class="max-w-md">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Amount<span class="text-red-500">*</span>
        </label>
        <nz-input-number
          [(ngModel)]="creditAmount"
          #credAmount="ngModel"
          [nzMin]="0"
          [nzMax]="cash?.amount_received"
          [nzStep]="1"
          nzPlaceHolder="Enter amount"
          class="payment-input-number w-[250px] rounded-md focus:border-primary hover:border-primary"
          name="credit_amount"
        ></nz-input-number>
        <span
          *ngIf="credAmount.errors?.required && isAdded"
          class="text-red-500 text-xs mt-1 block"
        >
          Please add Total Amount!
        </span>
        <span *ngIf="+creditAmount === 0 && isAdded" class="text-red-500 text-xs mt-1 block">
          Zero value not allowed
        </span>
        <span
          *ngIf="
            !credAmount.errors?.required &&
            +creditAmount > cash?.amount_received &&
            isAdded
          "
          class="text-red-500 text-xs mt-1 block"
        >
          Amount should not be greater than {{ cash?.amount_received }}
        </span>
      </div>
    </div>

    <!-- Error Message for Mixed Payment -->
      <div
        *ngIf="
          (paymentTypeCheque === 'partial' && paymentTypeCredit === 'full') ||
          (paymentTypeCheque === 'full' && paymentTypeCredit === 'partial')
        "
      class="px-6 py-4 bg-red-50 dark:bg-red-900/20 border-t border-b border-red-200 dark:border-red-800"
    >
      <p class="text-red-600 dark:text-red-400 text-sm font-medium">
        You have to choose "Partial Amount" to use both Credit and Cheque Payment!
      </p>
      </div>

    <!-- Modal Footer -->
    <div class="px-6 py-4 bg-gray-50 dark:bg-black border-t border-gray-200 dark:border-[#333333] rounded-b-lg flex justify-end gap-3">
      <button
        type="button"
        id="close-payment-modal"
        class="px-6 py-2 leading-none text-[13px] rounded-[5px] font-primary border border-primary dark:border-white bg-transparent text-primary dark:text-white dark:opacity-70 hover:bg-red-600 hover:border-red-600 hover:text-white focus:bg-red-600 focus:border-red-600 focus:text-white transition-colors"
        (click)="paymentCancelled()"
        aria-label="Close"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="
          (paymentTypeCheque === 'partial' && paymentTypeCredit === 'full') ||
          (paymentTypeCheque === 'full' && paymentTypeCredit === 'partial')
        "
        class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400 disabled:border-gray-400"
        (click)="addPaymentMethod()"
      >
        Add
      </button>
    </div>
    </div>
  </div>

<!-- Products Listing Sidebar - Tailwind CSS -->
<div  
  id="product-cl-sec"
  (clickOutside)="clickedOutSide($event)"
  [ngClass]="showProducts ? 'flex' : 'hidden'"
  class="fixed inset-0 bg-white/50 backdrop-blur-sm dark:bg-black/50 dark:backdrop-blur-sm z-50 items-center justify-center p-4">
  <div 
    class="h-full fixed overflow-visible top-0 bottom-0 right-0 z-[1000] flex-row flex-none flex w-full md:w-[600px]">
    <div
      class="flex flex-col h-full w-full md:w-[600px] transition-[width] duration-500 bg-white dark:bg-darkprimary rounded-tl-lg rounded-bl-lg shadow-[-6px_0_16px_-8px_rgba(0,0,0,0.08),_-9px_0_28px_0_rgba(0,0,0,0.05),_-12px_0_48px_16px_rgba(0,0,0,0.03)]">
      
      <!-- Header -->
      <div
        class="relative flex items-center justify-between h-auto rounded-tl-lg bg-gradient-to-r from-[#1e54d3] to-[#0038ba] text-white px-4 py-3 text-[16px] leading-[22px]">
        <h2 class="text-base font-bold text-white font-primary mb-0">
          Add
          <span class="font-light">Product</span>
        </h2>
        <div>
          <button 
            id="pl-close" 
            (click)="closeProductsList()" 
            class="hover:opacity-80 transition-opacity">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-x mt-1"
              viewBox="0 0 16 16">
              <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708">
              </path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="px-4 py-3 bg-white dark:bg-darkprimary border-b border-gray-200 dark:border-[#333333]">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          <input
            type="text"
            class="w-full pl-10 pr-4 py-2 border border-[#ececec] dark:border-[#434343] rounded-lg bg-[#f6f6f6] dark:bg-[#141414] text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none  focus:border-primary font-primary text-sm dont-close-products"
            [(ngModel)]="productSearchText"
            (keyup)="searchProduct()"
            placeholder="Search products..."
          />
        </div>
      </div>

      <!-- Content - Product Listing -->
      <div class="flex-1 overflow-auto p-4 bg-[#f6f6f6] dark:bg-darkprimary">
        <div *ngIf="!loadingProducts" class="space-y-2">
          <!-- Product items -->
          <div 
            *ngFor="let product of dispProducts; let i = index"
            class="bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#333333] rounded-lg p-3 hover:shadow-md transition-shadow relative">
            <!-- Scheme Badge -->
                            <div
                              *ngIf="product.schemes?.length"
              class="absolute -top-2 -left-2 bg-yellow-400 text-black text-xs font-semibold px-2 py-1 rounded shadow-sm z-10">
                              Scheme
                            </div>
            
            <div class="flex items-start justify-between gap-3">
              <!-- Product Image & Info -->
              <div class="flex items-start space-x-3 flex-1">
                            <img
                  class="w-14 h-14 rounded border border-gray-200 dark:border-[#434343] object-cover flex-shrink-0"
                              src="{{ product.thumbnail }}"
                  alt="{{ product.item_name }}"
                  onerror="this.src='assets/images/default_product.jpg'"
                            />
                <div class="flex-1 min-w-0">
                  <h3 class="text-sm font-medium text-gray-900 dark:text-white font-primary leading-snug">
                              {{ product.item_name }}
                  </h3>
                  <p class="text-[13px] text-gray-500 dark:text-gray-400 mt-1">
                                SKU: {{ product.item_sku }}
                  </p>
                  <p class="text-[13px] text-gray-600 dark:text-gray-300 mt-1 font-medium">
                    Available: <span class="text-primary">{{ product.availble_stock }}</span>
                  </p>
                            </div>
                          </div>
              
              <!-- Add Button -->
              <div class="flex my-auto ">
                          <button
                            *ngIf="!product.qtyAdded"
                  class="px-4 py-2 text-[13px] leading-none font-primary bg-white text-primary border border-primary rounded-md hover:bg-primary hover:text-white transition-colors disable:border-primary disable:text-black disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-black disabled:hover:text-black dont-close-quantity whitespace-nowrap"
                            (click)="openQuantityModal(product)"
                            [disabled]="+product.availble_stock<1"
                          >
                            Add 
                          </button>
                          <button
                            *ngIf="product.qtyAdded"
                  class="px-4 py-2 text-[13px] leading-none font-primary bg-primary text-white rounded-md cursor-not-allowed dont-close-quantity whitespace-nowrap"
                            [disabled]="product.isAdded"
                            >
                            Added 
                          </button>
                  </div>
                </div>
              </div>
            </div>

        <!-- Loading State -->
        <div *ngIf="loadingProducts" class="flex flex-col items-center justify-center py-12">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
          <p class="mt-4 text-gray-500 dark:text-gray-400 font-primary">Loading Products...</p>
          </div>

        <!-- Empty State -->
        <div *ngIf="!loadingProducts && dispProducts?.length === 0" class="flex flex-col h-[calc(100vh-31vh)]
         items-center justify-center">
          <svg class="w-16 h-16 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
          </svg>
          <p class="mt-4 text-gray-500 dark:text-gray-400 font-primary text-center">No products found</p>
        </div>
      </div>
 
      <!-- Footer -->
      <div class="bg-gray-50 dark:bg-black pl-4 p-3 rounded-bl-lg border-t border-gray-200 dark:border-[#333333]">
        <div>
    <button
      id="pl-prod-close"
            type="button"
      (click)="closeProductsList()"
            class="px-6 py-2 leading-none text-[13px] rounded-[5px] font-primary border border-primary dark:border-white bg-transparent text-primary dark:text-white dark:opacity-70 hover:bg-red-600 hover:border-red-600 hover:text-white focus:bg-red-600 focus:border-red-600 focus:text-white transition-colors">
      Cancel
    </button>
  </div>
      </div>
    </div>
  </div>
</div>

<div class="container mx-auto px-4 pb-24">
  <div class="mt-3 mb-3">
      <div class="flex justify-between items-center text-left">
          <div>
              <h1 class="text-lg text-secondary dark:text-gray-400 font-primary font-medium mb-0">New  <span
                      class="font-light"> Order</span></h1>
          </div>
          <div></div>
      </div>
  </div>
  <div class="bg-white border-2 border-top-primary dark:bg-black dark:border-[#333333] p-3 xl:p-5 rounded-lg relative shadow-[0_0_5px_#0000001a]">
     
    <div class="flex flex-wrap items-center gap-3 mb-3">
      <!-- Employee Select -->
      <div class="w-[260px]">
        <nz-select
          nzShowSearch
          nzAllowClear
            [(ngModel)]="selectedEmployee"
          (ngModelChange)="getRoutes()"
          nzPlaceHolder="Select Employee"
          [nzDropdownMatchSelectWidth]="false"
          [nzDropdownStyle]="{ 'z-index': '9999' }"
          [nzDisabled]="isChequeAdded || isCreditAdded"
          class="w-full employee-select"
        >
          <nz-option nzDisabled nzLabel="Select Employee" [nzValue]="null"></nz-option>
          <nz-option
              *ngFor="let orderBooker of orderBookers"
            [nzValue]="orderBooker.employee_id"
            [nzLabel]="orderBooker.employee_first_name + ' ' + orderBooker.employee_last_name"
          ></nz-option>
        </nz-select>
      </div>

      <!-- Route Select -->
      <div class="w-[260px]">
        <nz-select
          nzShowSearch
          nzAllowClear
          [(ngModel)]="selectedRoute"
          (ngModelChange)="getRetailerByRoute()"
          [nzPlaceHolder]="!selectedEmployee ? 'Select Employee First' : 'Select Route'"
          [nzDropdownMatchSelectWidth]="false"
          [nzDropdownStyle]="{ 'z-index': '9999' }"
          [nzDisabled]="isChequeAdded || isCreditAdded"
          class="w-full route-select"
        >
          <nz-option 
            *ngIf="!selectedEmployee" 
            nzDisabled 
            nzLabel="Select Employee First" 
            [nzValue]="null"
          ></nz-option>
          <nz-option 
            *ngIf="selectedEmployee" 
            nzDisabled 
            nzLabel="Select Route" 
            [nzValue]="null"
          ></nz-option>
          <nz-option
            *ngFor="let route of routes"
            [nzValue]="route.route_id"
            [nzLabel]="route.name"
          ></nz-option>
        </nz-select>
        </div>

      <!-- Retailer Select -->
      <div class="w-[260px]">
        <nz-select
          nzShowSearch
          nzAllowClear
          [(ngModel)]="selectedRetailer"
          (ngModelChange)="getDiscountSlabs()"
          [nzPlaceHolder]="!selectedRoute ? 'Select Route First' : 'Select Retailer'"
          [nzDropdownMatchSelectWidth]="false"
          [nzDropdownStyle]="{ 'z-index': '9999' }"
          [nzDisabled]="isChequeAdded || isCreditAdded"
          class="w-full retailer-select"
        >
          <nz-option 
            *ngIf="!selectedRoute" 
            nzDisabled 
            nzLabel="Select Route First" 
            [nzValue]="null"
          ></nz-option>
          <nz-option 
            *ngIf="selectedRoute" 
            nzDisabled 
            nzLabel="Select Retailer" 
            [nzValue]="null"
          ></nz-option>
          <nz-option
            *ngFor="let retailer of retailers"
            [nzValue]="retailer"
            [nzLabel]="retailer.retailer_name"
          ></nz-option>
        </nz-select>
      </div>

      <!-- Add Product Button -->
      <button
        id="productlist01"
        (click)="showProductsList($event)"
            [disabled]="isChequeAdded || isCreditAdded"
        class="px-6 py-2 leading-none text-[14px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:bg-blue-700 focus:border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400 disabled:border-gray-400 disabled:text-gray-200 transition-all duration-200"
      >
        Add Product
      </button>
    </div>
 
      <div class="grid grid-cols-1 md:grid-cols-2 gap-y-1 gap-x-4 border border-gray-200 dark:border-[#333333] bg-gray-50 dark:bg-[#141414] rounded-lg p-2">
        <div>
          <strong class="font-semibold pl-1.5">Retailer Name:&nbsp;</strong>
          {{ selectedRetailer?.retailer_name || "--" }}
          {{ selectedRetailer ? (selectedRetailer?.retailer_register == 1 ? '(Registered)' : '(Non Registered)') : '' }}
        </div>
    
        <div>
          <strong class="font-semibold pl-1.5">Channel Type:&nbsp;</strong>
          {{ selectedRetailer?.type || "--" }}
          {{ selectedRetailer && " (" + selectedRetailer?.segment_name + ")" }}
        </div>
    
        <div>
          <strong class="font-semibold pl-1.5">Location:&nbsp;</strong>
          {{ selectedRetailer?.loc || "--" }}
        </div>
    
        <div>
          <strong class="font-semibold pl-1.5">Territory:&nbsp;</strong>
          {{ selectedRetailer?.territory || "--" }}
        </div>
      </div>
 

      <!-- Product Table - Tailwind CSS with Light/Dark Mode -->
      <div class="mt-4 rounded-md border-t-[3px] border-[#0038ba] bg-white dark:bg-[#1f1f1f] py-2 xl:py-4 shadow-sm transition-colors duration-200">
        
        <!-- Table Header -->
        <div class="flex items-center text-xs font-semibold text-[#0038ba] dark:text-[#4d7fff] pb-2">
          <div class="w-[230px] pl-1 pr-4">Product Name</div>
          <div class="w-[130px] pr-4">Unit</div>
          <div class="w-[87px] text-left pr-3">QTY.</div>
          <div class="w-[87px] text-left pr-3">T.P</div>
          <div class="w-[87px] text-left pr-3">T.O</div>
          <div class="w-[87px] text-left pr-3">T. Dis. (%)</div>
          <div class="w-[87px] text-left pr-3">S. Disc.</div>
          <div class="w-[87px] text-left pr-3" *ngIf="permissions.Secondary_Orders.extra_discount">E. Disc.</div>
          <div class="w-[87px] text-left pr-3" title="General Sales Tax">GST</div>
          <div class="w-[87px] text-left pr-3" title="Advance Income Tax">AIT</div>
          <div class="w-[100px] text-right">Net Amount</div>
        </div>

        <!-- Product Rows -->
        <div
          *ngFor="let product of selectedProducts; let ind = index"
          class="group flex items-center border-t border-gray-200 dark:border-gray-700 py-2 bg-white dark:bg-[#1f1f1f] hover:bg-gray-50 dark:hover:bg-[#2a2a2a] transition-colors duration-150 relative"
        >
          <!-- Product Name -->
          <div class="w-[230px] pl-1 pr-4">
            <div class="text-xs text-gray-800 dark:text-gray-200 leading-normal">
              {{ product.item_name }}
              <span class="block opacity-60 pt-1 text-[11px]">
                SKU: {{ product.item_sku }}
              </span>
            </div>
          </div>

          <!-- Unit -->
          <div class="w-[130px] pr-4">
            <div class="text-xs text-gray-800 dark:text-gray-300 h-6 flex items-center">
              {{ product.unit_name }}
            </div>
          </div>

          <!-- Quantity Input -->
          <div class="w-[87px] pr-3">
            <input
              class="w-full h-6 px-2 text-xs text-left bg-transparent border border-transparent group-hover:border-gray-300 dark:group-hover:border-[#2a2a2a] rounded focus:border-gray-300 dark:focus:border-gray-600 focus:shadow-sm focus:outline-none text-gray-800 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              type="text"
              [id]="product.item_id"
              [disabled]="isChequeAdded || isCreditAdded"
              (keyup)="setQuantity(product)"
              (keydown)="isNumber($event, 'quantity')"
              placeholder="0"
              [(ngModel)]="product.stockQty"
            />
          </div>

          <!-- Trade Price -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center">
            {{ product.item_trade_price || 0.0 | number: "1.2-2" }}
          </div>

          <!-- Trade Offer -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center" [ngClass]="{'text-green-600 dark:text-green-400 font-semibold': product.scheme_quantity_free > 0}">
            {{ product.scheme_id && product.scheme_type =='bundle_offer' ? ((+product.scheme_discount * +product.scheme_bundle_interval) | number: "1.2-2") : +product.stockQty * product.scheme_discount | number: "1.2-2" }} {{product.scheme_quantity_free > 0 ? "("+product.scheme_quantity_free+")":"" }}
          </div>

          <!-- Trade Discount -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center">
            {{ product.trade_discount }} {{ product.slab_discount_type == 'percentage' ? '%':'' }}
          </div>

          <!-- Special Discount -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center">
            {{ +product.stockQty * product.special_discount || 0.0 | number: "1.2-2" }}
          </div>

          <!-- Extra Discount Input -->
          <div class="w-[87px] pr-3" *ngIf="permissions?.Secondary_Orders?.extra_discount">
            <input
              [readonly]="isCreditAdded || isChequeAdded || +product.stockQty < 1"
              class="w-full h-6 px-2 text-xs text-left bg-transparent border border-transparent group-hover:border-gray-300 dark:group-hover:border-[#2a2a2a] rounded focus:border-gray-300 dark:focus:border-gray-600 focus:shadow-sm focus:outline-none text-gray-800 dark:text-gray-200 read-only:opacity-50 read-only:cursor-not-allowed transition-colors"
              type="text"
              id="extraDiscount-{{product.item_id}}"
              placeholder="0"
              [(ngModel)]="product.extra_discount"
              (keyup)="calculateExtraDiscount(product)"
              (keydown)="isNumber($event)"
            />
          </div>

          <!-- GST -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center">
            {{ product.gst_tax_amount_temp || 0.0 | number: "1.2-2" }}
          </div>

          <!-- AIT -->
          <div class="w-[87px] pr-3 text-xs text-left text-gray-800 dark:text-gray-300 h-6 flex items-center">
            {{ product.adv_inc_tax_amount_temp || 0.0 | number: "1.2-2" }}
          </div>

          <!-- Net Amount -->
          <div class="w-[100px] text-xs text-right text-gray-800 dark:text-gray-300 h-6 flex items-center justify-end font-medium">
            {{ product.total_amount_after_tax || 0.0 | number: "1.2-2" }}
          </div>

          <!-- Delete Button -->
          <button
            [disabled]="isChequeAdded || isCreditAdded"
            (click)="removeProductFromOrder(product, ind)"
            class="hidden group-hover:block absolute right-[-5px] top-1/2 -translate-y-1/2 p-1.5 text-gray-400 hover:text-red-500 dark:text-gray-500 dark:hover:text-red-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
            title="Delete"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
              <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
            </svg>
          </button>
        </div>

        <!-- Empty State -->
        <div *ngIf="!selectedProducts.length" class="border-t border-gray-200 dark:border-gray-700 py-12 bg-white dark:bg-[#1f1f1f]">
          <h2 class="text-center text-gray-400 dark:text-gray-400 font-medium text-base">Add products to counter sale...</h2>
        </div>

        <!-- Summary Section -->
        <!-- Total Items Row -->
        <div class="flex items-center border-t border-[#0038ba] dark:border-[#4d7fff] pt-3 mt-2 text-sm">
          <div class="w-[230px] pl-1 pr-4 h-5 flex items-center text-gray-800 dark:text-gray-300">Total Items</div>
          <div class="w-[130px] pr-4 h-5 flex items-center text-gray-800 dark:text-gray-300">
            {{ selectedProducts.length }}
          </div>
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Gross Amount:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ grossAmount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Trade Offer -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Trade Offer:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ schemeDiscount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Trade Discount -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Trade Discount:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ tradeDiscount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Special Discount -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Special Discount:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ specialDiscount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Extra Discount -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Extra Discount:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ extraDiscount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Loyalty Discount -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">Loyalty Discount:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ loyaltyDiscount | number: "1.2-2" }}
          </div>
        </div>

        <!-- GST -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300" title="General Sales Tax">General Sales Tax(GST):</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ gst_tax | number: "1.2-2" }}
          </div>
        </div>

        <!-- AIT -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300" title="Advance Income Tax">Advance Income Tax(AIT):</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ adv_inc_tax | number: "1.2-2" }}
          </div>
        </div>

        <!-- Total Tax -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300" title="Total Tax">Total Tax:</div>
          <div class="w-[100px] text-right h-5 flex items-center justify-end font-['Rationale',sans-serif] text-[17px] leading-none text-gray-800 dark:text-gray-200">
            {{ tax | number: "1.2-2" }}
          </div>
        </div>

        <!-- Total Amount Due -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">
            <strong class="font-semibold">Total Amount Due:</strong>
          </div>
          <div class="w-[100px] text-right h-5 font-['Rationale',sans-serif] flex items-center justify-end text-[18px] text-[#0038ba] dark:text-[#4d7fff]">
            {{ dueAmount | number: "1.2-2" }}
          </div>
        </div>

        <!-- Cash -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">
            <strong class="font-semibold">Cash:</strong>
          </div>
          <div class="w-[100px] text-right h-5 font-['Rationale',sans-serif] flex items-center justify-end text-[18px] text-[#0038ba] dark:text-[#4d7fff]">
            {{ cash?.amount_received || 0 | number: "1.2-2" }}
          </div>
        </div>

        <!-- Cheque Payment -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">
            <strong class="font-semibold">Cheque Payment:</strong>
          </div>
          <div class="w-[100px] text-right h-5 font-['Rationale',sans-serif] flex items-center justify-end text-[18px] text-[#0038ba] dark:text-[#4d7fff]">
            {{ cheque?.amount_received || 0 | number: "1.2-2" }}
          </div>
        </div>

        <!-- Credited Amount -->
        <div class="flex items-center text-sm mt-1">
          <div class="flex-1"></div>
          <div class="w-[196px] text-right pr-3 h-5 flex items-center justify-end text-gray-800 dark:text-gray-300">
            <strong class="font-semibold">Credited Amount:</strong>
          </div>
          <div class="w-[100px] text-right h-5 font-['Rationale',sans-serif] flex items-center justify-end text-[18px] text-[#0038ba] dark:text-[#4d7fff]">
            {{ credit?.amount_received || 0 | number: "1.2-2" }}
          </div>
        </div>

      </div>
   
  </div>
</div>


<!-- Bottom Action Bar - Tailwind CSS -->
<div class="fixed bottom-0 !z-[30] left-0 right-0 bg-white dark:bg-darkprimary border-t border-gray-200 dark:border-[#333333] shadow-[0_-2px_10px_rgba(0,0,0,0.1)] dark:shadow-[0_-2px_10px_rgba(0,0,0,0.3)]">
  <div class="mx-auto px-4 w-full">
    <div class="flex items-center justify-between py-3 gap-3">
      <!-- Left Side Buttons -->
      <div class="flex items-center gap-2 flex-wrap">
        <!-- Add Cheque Button -->
        <button
          *ngIf="!isOrdering && !isChequeAdded"
          type="button"
          class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:outline-none transition-colors"
          (click)="isCredit = false; isFullyPaymentAdded('Cheque Payment')"
        >
          Add Cheque
        </button>
        
        <!-- Remove Cheque Button -->
        <button
          *ngIf="!isOrdering && isChequeAdded"
          type="button"
          class="px-6 py-2 leading-none text-[13px] border border-red-600 rounded-[5px] font-primary bg-red-600 text-white hover:bg-red-700 hover:border-red-700 focus:outline-none  transition-colors"
          (click)="removeCheque()"
        >
          Remove Cheque
        </button>
        
        <!-- Add Credit Button -->
        <button
          *ngIf="!isOrdering && !isCreditAdded"
          type="button"
          class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:outline-none transition-colors"
          (click)="isCredit = true; isFullyPaymentAdded('Credit')"
        >
          Add Credit
        </button>
        
        <!-- Remove Credit Button -->
        <button
          *ngIf="!isOrdering && isCreditAdded"
          type="button"
          class="px-6 py-2 leading-none text-[13px] border border-red-600 rounded-[5px] font-primary bg-red-600 text-white hover:bg-red-700 hover:border-red-700 focus:outline-none transition-colors"
          (click)="removeCredit()"
        >
          Remove Credit
        </button>
      </div>

      <!-- Right Side Buttons -->
      <div class="flex items-center gap-2 flex-wrap">
        <!-- Loading Spinner -->
        <button
          *ngIf="isOrdering"
          type="submit"
          class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white cursor-not-allowed flex items-center gap-2"
          disabled
        >
          <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Loading...</span>
        </button>

        <!-- Cancel Button -->
        <button
          *ngIf="!isOrdering"
          type="button"
          class="px-6 py-2 leading-none text-[13px] rounded-[5px] font-primary border border-primary dark:border-white bg-transparent text-primary dark:text-white dark:opacity-70 hover:bg-red-600 hover:border-red-600 hover:text-white focus:bg-red-600 focus:border-red-600 focus:text-white transition-colors"
          [routerLink]="['/home']"
        >
          Cancel
        </button>
        
        <!-- Save Order Button -->
        <button
          *ngIf="!isOrdering"
          type="button"
          class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-blue-700 hover:border-blue-700 focus:outline-none  transition-colors"
          (click)="setOrderFields()"
        >
          Save Order
        </button>
      </div>

      <!-- Hidden Modal Trigger -->
      <button
        *ngIf="!isOrdering"
        id="open-modal-payment"
        class="hidden"
        data-toggle="modal"
        data-target="#exampleModal2"
      >
        Show Modal
      </button>
    </div>
  </div>
</div>