<app-products-drawer
  *ngIf="showProducts"
  [selectedRetailer]="selectedRetailer"
  [orderType]="'dispatch'"
  [orderedProducts]="orderDetails?.items"
  [loadingProducts]="loadingProduct"
  [allProducts]="inventory"
  [productSchemes]="schemes"
  [productMerchantDiscount]="merchantDiscount"
  [discountSlabs] = "discountSlabs"
  [taxClasses] = "taxClasses"
  [specialDiscounts]="specialDiscounts"
  (drawerClosed)="closeNewProducts()"
  (productSelected)="addNewProductToOrder($event)"
>
</app-products-drawer>


<div class="container mx-auto px-4 pb-24 mt-4">
  <div class="bg-white px-1 border-1 border-t-2 border-t-primary border-gray-200 dark:bg-[#1f1f1f] dark:border-[#333333] dark:border-t-primary rounded-lg relative shadow-[0_0_5px_#0000001a] dark:shadow-[0_0_5px_rgba(255,255,255,0.05)]">
    <!-- Tabs Navigation - Pure Tailwind CSS with Dark Mode -->
    <div class="w-full mb-3 grid grid-cols-5" role="tablist" id="pills-tab">
      <!-- Stock Allocation Tab -->
      <div class="flex items-center justify-center relative">
        <button
          type="button"
          class="relative w-full pt-2 pb-6 px-5 text-center transition-all duration-200 font-primary text-base font-light"
          [ngClass]="{
            'bg-white dark:bg-[#1f1f1f] text-secondary dark:text-neutral-300 cursor-pointer': currentTab === 1,
            'text-gray-400 dark:text-[#808080] hover:text-gray-600 dark:hover:text-[#b0b0b0] cursor-pointer': currentTab !== 1 && isTabVisited(1),
            'text-gray-300 dark:text-[#555555] cursor-not-allowed': currentTab !== 1 && !isTabVisited(1)
          }"
          (click)="onTabClick(1)"
          [disabled]="!isTabVisited(1) && currentTab !== 1"
          role="tab"
          aria-selected="currentTab === 1"
          id="pills-home-tab"
        >
          <span 
            class="block"
            [ngClass]="{
              'font-semibold text-primary dark:text-primary': currentTab === 1,
              'font-normal': currentTab !== 1
            }"
          >Stock Allocation</span>
          <span 
            class="absolute left-1/2 -translate-x-1/2 w-[38px] h-[38px] rounded-full border-2 border-white dark:border-[#1f1f1f] flex items-center justify-center transition-all duration-200 z-[5]"
            [ngClass]="{
              'bg-gradient-to-r from-[#1e54d3] to-primary': currentTab === 1,
              'bg-gray-300 dark:bg-[#555555] dark:border-[#2a2a2a]': currentTab !== 1
            }"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-[20px] h-[20px] text-white" viewBox="0 0 16 16">
            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
          </svg>
          </span>
        </button>
        <!-- Active tab bottom border (blue) -->
        <div 
          *ngIf="currentTab === 1"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-primary transition-all duration-200"
        ></div>
        <!-- Inactive tab bottom border (gray) -->
        <div 
          *ngIf="currentTab !== 1"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-gray-300 dark:bg-[#444444] transition-all duration-200"
        ></div>
      </div>

      <!-- Orders Tab -->
      <div class="flex items-center justify-center relative">
        <button
          type="button"
          class="relative w-full pt-2 pb-6 px-5 text-center transition-all duration-200 font-primary text-base font-light"
          [ngClass]="{
            'bg-white dark:bg-[#1f1f1f] text-secondary dark:text-neutral-300 cursor-pointer': currentTab === 2,
            'text-gray-400 dark:text-[#808080] hover:text-gray-600 dark:hover:text-[#b0b0b0] cursor-pointer': currentTab !== 2 && isTabVisited(2),
            'text-gray-300 dark:text-[#555555] cursor-not-allowed': currentTab !== 2 && !isTabVisited(2)
          }"
          (click)="onTabClick(2)"
          [disabled]="!isTabVisited(2) && currentTab !== 2"
          role="tab"
          aria-selected="currentTab === 2"
          id="pills-orders-tab"
        >
          <span 
            class="block"
            [ngClass]="{
              'font-semibold text-primary dark:text-primary': currentTab === 2,
              'font-normal': currentTab !== 2
            }"
          >Orders</span>
          <span 
            class="absolute left-1/2 -translate-x-1/2 w-[38px] h-[38px] rounded-full border-2 border-white dark:border-[#1f1f1f] flex items-center justify-center transition-all duration-200 z-[5]"
            [ngClass]="{
              'bg-gradient-to-r from-[#1e54d3] to-primary': currentTab === 2,
              'bg-gray-300 dark:bg-[#555555] dark:border-[#2a2a2a]': currentTab !== 2
            }"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-[20px] h-[20px] text-white" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
            <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
            <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
          </svg>
          </span>
        </button>
        <!-- Active tab bottom border (blue) -->
        <div 
          *ngIf="currentTab === 2"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-primary transition-all duration-200"
        ></div>
        <!-- Inactive tab bottom border (gray) -->
        <div 
          *ngIf="currentTab !== 2"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-gray-300 dark:bg-[#444444] transition-all duration-200"
        ></div>
      </div>

      <!-- Credit Tab -->
      <div class="flex items-center justify-center relative">
        <button
          type="button"
          class="relative w-full pt-2 pb-6 px-5 text-center transition-all duration-200 font-primary text-base font-light"
          [ngClass]="{
            'bg-white dark:bg-[#1f1f1f] text-secondary dark:text-neutral-300 cursor-pointer': currentTab === 3,
            'text-gray-400 dark:text-[#808080] hover:text-gray-600 dark:hover:text-[#b0b0b0] cursor-pointer': currentTab !== 3 && isTabVisited(3),
            'text-gray-300 dark:text-[#555555] cursor-not-allowed': currentTab !== 3 && !isTabVisited(3)
          }"
          (click)="onTabClick(3)"
          [disabled]="!isTabVisited(3) && currentTab !== 3"
          role="tab"
          aria-selected="currentTab === 3"
          id="pills-contact-tab"
        >
          <span 
            class="block"
            [ngClass]="{
              'font-semibold text-primary dark:text-primary': currentTab === 3,
              'font-normal': currentTab !== 3
            }"
          >Credit</span>
          <span 
            class="absolute left-1/2 -translate-x-1/2 w-[38px] h-[38px] rounded-full border-2 border-white dark:border-[#1f1f1f] flex items-center justify-center transition-all duration-200 z-[5]"
            [ngClass]="{
              'bg-gradient-to-r from-[#1e54d3] to-primary': currentTab === 3,
              'bg-gray-300 dark:bg-[#555555] dark:border-[#2a2a2a]': currentTab !== 3
            }"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-[20px] h-[20px] text-white" viewBox="0 0 16 16">
            <path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73z"/>
          </svg>
          </span>
        </button>
        <!-- Active tab bottom border (blue) -->
        <div 
          *ngIf="currentTab === 3"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-primary transition-all duration-200"
        ></div>
        <!-- Inactive tab bottom border (gray) -->
        <div 
          *ngIf="currentTab !== 3"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-gray-300 dark:bg-[#444444] transition-all duration-200"
        ></div>
      </div>

      <!-- Load Tab -->
      <div class="flex items-center justify-center relative">
        <button
          type="button"
          class="relative w-full pt-2 pb-6 px-5 text-center transition-all duration-200 font-primary text-base font-light"
          [ngClass]="{
            'bg-white dark:bg-[#1f1f1f] text-secondary dark:text-neutral-300 cursor-pointer': currentTab === 4,
            'text-gray-400 dark:text-[#808080] hover:text-gray-600 dark:hover:text-[#b0b0b0] cursor-pointer': currentTab !== 4 && isTabVisited(4),
            'text-gray-300 dark:text-[#555555] cursor-not-allowed': currentTab !== 4 && !isTabVisited(4)
          }"
          (click)="onTabClick(4)"
          [disabled]="!isTabVisited(4) && currentTab !== 4"
          role="tab"
          aria-selected="currentTab === 4"
          id="pills-load-tab"
        >
          <span 
            class="block"
            [ngClass]="{
              'font-semibold text-primary dark:text-primary': currentTab === 4,
              'font-normal': currentTab !== 4
            }"
          >Load</span>
          <span 
            class="absolute left-1/2 -translate-x-1/2 w-[38px] h-[38px] rounded-full border-2 border-white dark:border-[#1f1f1f] flex items-center justify-center transition-all duration-200 z-[5]"
            [ngClass]="{
              'bg-gradient-to-r from-[#1e54d3] to-primary': currentTab === 4,
              'bg-gray-300 dark:bg-[#555555] dark:border-[#2a2a2a]': currentTab !== 4
            }"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-[20px] h-[20px] text-white" viewBox="0 0 16 16">
            <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
          </svg>
          </span>
        </button>
        <!-- Active tab bottom border (blue) -->
        <div 
          *ngIf="currentTab === 4"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-primary transition-all duration-200"
        ></div>
        <!-- Inactive tab bottom border (gray) -->
        <div 
          *ngIf="currentTab !== 4"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-gray-300 dark:bg-[#444444] transition-all duration-200"
        ></div>
      </div>

      <!-- Final Tab -->
      <div class="flex items-center justify-center relative">
        <button
          type="button"
          class="relative w-full pt-2 pb-6 px-5 text-center transition-all duration-200 font-primary text-base font-light"
          [ngClass]="{
            'bg-white dark:bg-[#1f1f1f] text-secondary dark:text-neutral-300 cursor-pointer': currentTab === 5,
            'text-gray-400 dark:text-[#808080] hover:text-gray-600 dark:hover:text-[#b0b0b0] cursor-pointer': currentTab !== 5 && isTabVisited(5),
            'text-gray-300 dark:text-[#555555] cursor-not-allowed': currentTab !== 5 && !isTabVisited(5)
          }"
          (click)="onTabClick(5)"
          [disabled]="!isTabVisited(5) && currentTab !== 5"
          role="tab"
          aria-selected="currentTab === 5"
          id="pills-final-tab"
        >
          <span 
            class="block"
            [ngClass]="{
              'font-semibold text-primary dark:text-primary': currentTab === 5,
              'font-normal': currentTab !== 5
            }"
          >Final</span>
          <span 
            class="absolute left-1/2 -translate-x-1/2 w-[38px] h-[38px] rounded-full border-2 border-white dark:border-[#1f1f1f] flex items-center justify-center transition-all duration-200 z-[5]"
            [ngClass]="{
              'bg-gradient-to-r from-[#1e54d3] to-primary': currentTab === 5,
              'bg-gray-300 dark:bg-[#555555] dark:border-[#2a2a2a]': currentTab !== 5
            }"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="w-[20px] h-[20px] text-white" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
          </svg>
          </span>
        </button>
        <!-- Active tab bottom border (blue) -->
        <div 
          *ngIf="currentTab === 5"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-primary transition-all duration-200"
        ></div>
        <!-- Inactive tab bottom border (gray) -->
        <div 
          *ngIf="currentTab !== 5"
          class="absolute bottom-0 left-0 right-0 h-[2px] bg-gray-300 dark:bg-[#444444] transition-all duration-200"
        ></div>
      </div>
    </div>


    <!-- Stock Allocation Tab Content - AG Grid -->
    <div
      [ngClass]="currentTab === 1 ? 'active show' : ''"
      class="tab-pane p-0 pt-5 tab_M fade"
      id="pills-contact"
      role="tabpanel"
      aria-labelledby="pills-contact-tab"
    >
      <div *ngIf="currentTab === 1">
        <div class="bg-white dark:bg-black dark:border-[#333333] border p-0 rounded-lg relative">
          <!-- Header -->
          <div class="flex justify-between items-center text-secondary rounded-tl-lg rounded-tr-lg text-base py-[10px] px-[15px] relative">
            <div>
              <h2 class="relative flex items-start pl-0 mb-0 text-secondary dark:text-gray-400 before:content-[''] before:absolute before:w-[2px] before:h-[18px] before:bg-primary before:left-[-16px] before:top-[5px] font-primary font-medium">
                Products &nbsp;<span class="font-light">List</span>
                <div class="ml-2 my-auto flex items-center">
                  <span class="bg-primary text-white text-[9px] p-[4px] leading-[1] rounded font-primary">{{ stockAllocation?.length || 0 }}</span>
                </div>
              </h2>
            </div>
            <div class="text-secondary dark:text-white">
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg class="h-4 w-4 text-gray-400" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.5014 7.00039C11.5014 7.59133 11.385 8.1765 11.1588 8.72246C10.9327 9.26843 10.6012 9.7645 10.1833 10.1824C9.76548 10.6002 9.2694 10.9317 8.72344 11.1578C8.17747 11.384 7.59231 11.5004 7.00136 11.5004C6.41041 11.5004 5.82525 11.384 5.27929 11.1578C4.73332 10.9317 4.23725 10.6002 3.81938 10.1824C3.40152 9.7645 3.07005 9.26843 2.8439 8.72246C2.61776 8.1765 2.50136 7.59133 2.50136 7.00039C2.50136 5.80691 2.97547 4.66232 3.81938 3.81841C4.6633 2.97449 5.80789 2.50039 7.00136 2.50039C8.19484 2.50039 9.33943 2.97449 10.1833 3.81841C11.0273 4.66232 11.5014 5.80691 11.5014 7.00039ZM10.6814 11.7404C9.47574 12.6764 7.95873 13.1177 6.43916 12.9745C4.91959 12.8314 3.51171 12.1145 2.50211 10.9698C1.49252 9.8251 0.957113 8.33868 1.0049 6.81314C1.05268 5.28759 1.68006 3.83759 2.75932 2.75834C3.83857 1.67908 5.28856 1.0517 6.81411 1.00392C8.33966 0.956136 9.82608 1.49154 10.9708 2.50114C12.1154 3.51073 12.8323 4.91862 12.9755 6.43819C13.1187 7.95775 12.6773 9.47476 11.7414 10.6804L14.5314 13.4704C14.605 13.539 14.6642 13.6218 14.7051 13.7138C14.7461 13.8058 14.7682 13.9052 14.77 14.0059C14.7717 14.1066 14.7532 14.2066 14.7155 14.3C14.6778 14.3934 14.6216 14.4782 14.5504 14.5494C14.4792 14.6206 14.3943 14.6768 14.301 14.7145C14.2076 14.7522 14.1075 14.7708 14.0068 14.769C13.9061 14.7672 13.8068 14.7452 13.7148 14.7042C13.6228 14.6632 13.54 14.6041 13.4714 14.5304L10.6814 11.7404Z" fill="currentColor"></path>
                  </svg>
                </div>
                <input
                  type="text"
                  id="stock-filter-text-box"
                  placeholder="Search products..."
                  autocomplete="off"
                  class="w-56 pl-[34px] pr-4 py-2 h-[32px] border outline-none border-gray-300 dark:border-[#333333] rounded-lg bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 dark:focus:border-primary focus:border-primary font-primary text-sm"
                  (input)="onStockQuickFilterChanged($event)"
                />
              </div>
            </div>
          </div>

          <!-- AG Grid Container -->
          <div>
            <div *ngIf="!loading && stockAllocation" class="ag-theme-quartz ag-grid-container w-[80px]">
              <ag-grid-angular
                [rowData]="stockAllocation"
                [columnDefs]="stockAllocationColumnDefs"
                [defaultColDef]="defaultColDef"
                [pagination]="true"
                [paginationPageSize]="10"
                [paginationPageSizeSelector]="[10, 20, 50, 100]"
                [suppressPaginationPanel]="false"
                [domLayout]="'autoHeight'"
                [animateRows]="true"
                [rowSelection]="{ type: 'single' }"
                [theme]="'legacy'"
                [stopEditingWhenCellsLoseFocus]="true"
                (gridReady)="onStockAllocationGridReady($event)"
              >
              </ag-grid-angular>
            </div>

            <!-- Loading State -->
            <div *ngIf="loading" class="flex justify-center items-center p-8">
              <app-loader-white></app-loader-white>
            </div>
          </div>
        </div>

        <!-- Allocation Errors Alert -->
        <div *ngIf="showAllocationErrors && allocationErrors" class="mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <strong class="text-red-800 dark:text-red-300 block mb-2">The available quantities for the following Products are less than the allocated Quantities.</strong>
              <ul class="list-disc list-inside text-red-700 dark:text-red-400 text-sm" [innerHTML]="allocationErrors"></ul>
            </div>
            <button
              type="button"
              (click)="closeAllocationAlert()"
              class="text-red-800 dark:text-red-300 hover:text-red-900 dark:hover:text-red-200 text-xl font-bold ml-4"
            >
              &times;
            </button>
          </div>
        </div>

        <!-- Check Allocation Button -->
        <div class="flex justify-end mt-4">
          <button
            type="button"
            (click)="onCheckAllocation()"
            [disabled]="tabLoading || !stockAllocation"
            class="px-6 py-2 leading-none text-[13px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-primary hover:text-white focus:bg-primary focus:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            <span *ngIf="tabLoading" class="inline-block mr-1">‚è≥</span>
            {{ tabLoading ? "Checking..." : "Check Allocation" }}
          </button>
        </div>
      </div>
    </div>

  <div class="tab-content" id="pills-tabContent">
    <div
      [ngClass]="currentTab === 2 ? 'active show' : ''"
      class="tab-pane tab_M p-0 PT-15 fade"
      id="pills-home"
      role="tabpanel"
      aria-labelledby="pills-home-tab"
    >
      <div class="row m-0 grayTopborder">
        <div id="orderList-id" class="col-4 p-0">
          <app-retailer-sub-list
            [retailers]="ordersRetailers"
            [loading]="loading || loadingProduct || savingOrder"
            (retailerChanged)="getOrderDetailsByRetailer($event)"
          ></app-retailer-sub-list>
        </div>

        <div class="col p-0">
          <div *ngIf="currentTab === 2" class="rightHeight">
            <app-order-items-list 
              *ngIf="!savingOrder && selectedRetailer"
              [orderDetail]="orderDetails" 
              [schemes]="schemes"
              [loyaltyoffers]="loyaltyoffers"
              [selectedRetailer]="selectedRetailer"
              [orders]="ordersRetailers"
              [allProducts]="inventory"
              [specialDiscounts]="specialDiscounts"
              [merchantDiscount]="merchantDiscount"
              [discountSlabs]="discountSlabs"
              [taxClasses]="taxClasses"
              [newProduct]="newProduct"
              [orderType]="'dispatch'"
              [stockAllocation]="stockAllocation"
              (openDrawer)="openProductsList()"
              (domChange)="onDomChange($event)"
            >
            </app-order-items-list>
            <div class="col-12" *ngIf="savingOrder">
              <app-loader-white></app-loader-white>
            </div>
            <div
              class="no-content"
              *ngIf="!savingOrder && !selectedRetailer"
            >
              <div
                class="no-content-container"
                style="
                  margin: auto;
                  display: table;
                  text-align: center;
                  color: #b7b7b7;
                "
              >
                <img src="assets/images/select order-icon.svg" alt="" />
                <strong>Select order to see details</strong>
              </div>
            </div>
          </div>
          <div *ngIf="selectedRetailer" class="col-md-12 bottom-act-btn">
            <button
              *ngIf="!savingOrder"
              (click)="setOrderItems()"
              [disabled]="!orderDetails?.items?.length"
              class="btn btn-primary mr-2 save_order_execution font13"
            >
              Save Order
            </button>

            
            <button
            [disabled]="!orderDetails?.items?.length"
            *ngIf="!savingOrder"
            data-toggle="modal"
            data-target="#order-hold-model"
            class="btn btn-cancel hold_order_btn mr-2 font13"
            > 
            Hold Order 
           </button>

            <button
              [disabled]="!orderDetails?.items?.length"
              *ngIf="!savingOrder"
              data-toggle="modal"
              data-target="#order-del"
              class="btn btn-cancel cancel_order_btn font13"
            >
              Cancel Order
            </button>

            <button
              *ngIf="savingOrder"
              type="submit"
              class="btn btn-primary mr-2"
              disabled
            >
              <div class="spinner-border text-light" role="status">
                <span class="sr-only"></span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      [ngClass]="currentTab === 3 ? 'active show' : ''"
      class="tab-pane p-0 PT-20 tab_M fade"
      id="pills-contact"
      role="tabpanel"
      aria-labelledby="pills-contact-tab"
    >
      <app-retailer-recovery></app-retailer-recovery>
    </div>

    <div
      [ngClass]="currentTab === 4 ? 'active show' : ''"
      class="tab-pane tab_M p-0 PT-15 fade"
      id="pills-load"
      role="tabpanel"
      aria-labelledby="pills-load-tab"
    >
      <div *ngIf="currentTab === 4" class="row m-0 grayTopborder">
        <div *ngIf="!loading" id="orderList-id2" class="col-4 p-0">
          <div class="_selectProList ProListHeight">
            <div class="header ProListHD">
              <div class="row">
                <div class="col-12">
                  <h2 class="w-100">Orders <span> List</span></h2>

                  <div class="select-all-op">
                    <div class="custom-control custom-checkbox">
                      <input
                        type="checkbox"
                        [(ngModel)]="isAllSelected"
                        name="all-selected"
                        id="all-selected"
                        class="custom-control-input"
                        (change)="allSelected()"
                        id="all-s"
                      />
                      <label class="custom-control-label" for="all-s"
                        >Select All</label
                      >
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="APS-list">
                    <i class="fa fa-search"></i>
                    <input
                      type="text"
                      class="form-control"
                      id=""
                      placeholder="Search"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="ProList-div">
              <div
                *ngFor="let order of ordersDispList; let ind = index"
                class="col-12 order-list select-checkmark"
              >
                <div class="ord-no">{{ ind + 1 }}</div>
                <div class="row">
                  <div class="col-8 pr-0">
                    <strong style="margin-bottom: 2px">{{
                      order.retailer_name
                    }}</strong>
                    <span
                      ><strong>Order Booker:</strong>
                      {{ order.emp_name }}</span
                    >
                    <span
                      ><i class="fa fa-map-marker-alt"></i>
                      {{ order.retailer_address }}</span
                    >
                  </div>
                  <div class="col-4 pl-0">
                    <div class="custom-control custom-checkbox">
                      <input
                        type="checkbox"
                        [name]="ind"
                        (change)="retailerSelected(order)"
                        class="custom-control-input"
                        [(ngModel)]="order.isSelected"
                        [id]="'ord' + ind"
                      />
                      <label
                        class="custom-control-label"
                        [for]="'ord' + ind"
                      ></label>
                    </div>
                    <div class="text-right">
                      Total Sales<span class="or-val"
                        >Rs.
                        {{
                          order.total_amount_after_tax || 0 | number: "1.2-2"
                        }}</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!loading" class="col p-0">
          <div class="rightHeight PT-5">
            <div class="header-tabs">
              <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a
                  class="nav-item nav-link"
                  [id]="cont.loadNumber"
                  [ngClass]="
                    cont.loadNumber === currentLoadContent.loadNumber
                      ? 'active'
                      : ''
                  "
                  (click)="changeCurrentLoad(cont.loadNumber)"
                  *ngFor="let cont of load?.content; let i = index"
                  id="nav-load1-tab"
                  >Load {{ cont.loadNumber }}</a
                >
              </div>
            </div>

            <div class="tab-content" id="nav-tabContent">
              <div
                class="tab-pane fade show active body_sales_agants"
                id="nav-load1"
                role="tabpanel"
                aria-labelledby="nav-load1-tab"
              >
                <div class="col-12 retailerTable">
                  <table
                    class="table table-hover dt-responsive nowrap th-boarder"
                    style="width: 100%"
                  >
                    <thead>
                      <tr>
                        <th rowspan="2">SN</th>
                        <th rowspan="2">Product Name</th>
                        <th colspan="2" style="text-align: center">
                           BOX/PIECE
                        </th> 
                      </tr>
                      <tr>
                        <th style="text-align: center">Order QTY</th>
                        <th style="text-align: center">FOC QTY</th>
                       <!--  <th style="text-align: center">Issued QTY</th> -->
                      </tr>
                    </thead>
                    <tbody>
                      <tr
                        *ngFor="
                          let item of currentLoadContent.items; 
                          let i = index
                        "
                      >
                        <td>{{ getItemSKU(item.item_id) }}</td>
                        <td>{{ getItemName(item.item_id) }}</td>
                        <td style="text-align: center">{{ (+item.actual_qty- +item.foc_qty) | number }}</td>
                        <td style="text-align: center">{{ item.foc_qty | number }}</td>
                        <!-- <td style="text-align: center">{{ item.issued_qty | number }}</td> -->
                        <!-- <td>
                          <input
                            class="value_input"
                            [(ngModel)]="item.issued_qty"
                            [name]="item.item_id"
                            [id]="item.item_id"
                            type="number"
                            (keyup)="updateDispatchedQty(item)"
                            (keydown)="isNumber($event, 'quantity')"
                          />
                        </td> -->
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12" *ngIf="loading">
          <app-loader-white></app-loader-white>
        </div>
      </div>
    </div>

    <div
      [ngClass]="currentTab === 5 ? 'active show' : ''"
      class="tab-pane tab_M p-0 PT-15 fade"
      id="pills-final"
      role="tabpanel"
      aria-labelledby="pills-final-tab"
    >
      <div class="col-12">
        <div class="row">
          <div class="col-8 PB-30">
            <div class="header PT-10 PB-10 mb-15">
              <h2 class="w-100">Load <span> Sheet</span></h2>
            </div>

            <table
              *ngIf="showFinalLoad"
              datatable
              [dtOptions]="dtOptions"
              class="table table-hover dt-responsive nowrap dc-table"
              id="example2"
              style="width: 100%"
            >
              <thead>
                <tr>
                  <th rowspan="2" style="vertical-align: middle">SN</th>
                  <th rowspan="2" style="vertical-align: middle;min-width:200px !important">
                    Product Name
                  </th>
                  <th
                    colspan="3"
                    style="text-align: center"
                    *ngFor="
                      let number of finalLoad.load[0].content;
                      let i = index
                    "
                  >
                    Load {{ i + 1 }}
                  </th>
                  <th colspan="2" style="text-align: center">
                    Extra Issuance
                  </th>
                  <th colspan="3" style="text-align: center">
                    Total Issuance
                  </th>
                </tr>
                <tr *ngIf="finalLoad.count == 3">
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                </tr>
                <tr *ngIf="finalLoad.count == 2">
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                </tr>
                <tr *ngIf="finalLoad.count == 1">
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>CTN/Bundle</th>
                  <th>Box/Piece</th>
                  <th>Weight</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of finalLoad.load">
                  <td>{{ product.item_sku }}</td>
                  <td style="min-width:200px !important">{{ product.item_name }}</td>
                  <ng-container
                    *ngFor="let loadContent of product.content"
                  >
                    <td>{{ loadContent.parent_qty | number }}</td>
                    <td>{{ loadContent.child_qty }}</td>
                    <td>{{ loadContent.total_weight }}</td>
                  </ng-container>
                  <td>{{ product.total_extra_primary_qty | number }}</td>
                  <td>{{ product.total_extra_secondary_qty | number }}</td>
                  <td>{{ product.total_primary_qty | number }}</td>
                  <td>{{ product.total_secondary_qty | number }}</td>
                  <td> {{product.total_weight }}</td> 
                 
                </tr>
              </tbody>
            </table>
          </div>

          <div class="col-4">
            <div class="cash-report" *ngIf="finalLoad">
              <div class="header">
                <div class="report_value">
                  <strong>Gross Total:</strong>
                  <span>{{
                    finalLoad.summary.total_gross_amount | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Trade Offer:</strong>
                  <span>{{
                    finalLoad.summary.total_trade_offer | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Trade Discount:</strong>
                  <span>{{
                    finalLoad.summary.total_trade_discount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Special Discount:</strong>
                  <span>{{
                    finalLoad.summary.total_special_discount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Booker Discount:</strong>
                  <span>{{
                    finalLoad.summary.total_booker_discount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Loyalty Discount:</strong>
                  <span>{{
                    finalLoad.summary.total_loyalty_discount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Total:</strong>
                  <span>{{
                    finalLoad.summary.total_gross_amount -
                      finalLoad.summary.total_trade_offer -
                      finalLoad.summary.total_trade_discount -
                      finalLoad.summary.total_special_discount -
                      finalLoad.summary.total_booker_discount  -
                      finalLoad.summary.total_loyalty_discount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value"><strong>Tax:</strong><span>{{finalLoad.summary.total_tax_amount | number: "1.2-2" }}</span>
                </div>
                <div class="report_value" style="color: #0038ba">
                  <strong>Total Amount Due:</strong>
                  <span>{{
                    finalLoad.summary.total_net_sale | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value">
                  <strong>Recovery:</strong>
                  <span>{{
                    finalLoad.summary.total_recovery_amount
                      | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value" style="color: #0038ba">
                  <strong>Total Issued Amount:</strong>
                  <span>{{
                    finalLoad.summary.issued_total_price | number: "1.2-2"
                  }}</span>
                </div>
                <div class="report_value" style="color: #0038ba">
                  <strong>Total Weight:</strong>
                  <span>{{finalLoad.summary.total_weight | number: "1.2-2"}}Kg</span>
                </div>
              </div>
              <div style="padding: 10px 15px">
                <div class="row act-btn-print">
                  <div class="col-4">
                    <a
                      (click)="getBookingSheet()"
                      class="btn btn-primary print-btn fontSize"
                      ><i class="fa fa-print"></i> Booking Sheet</a
                    >
                  </div>
                  <div class="col-4">
                    <a
                      (click)="generateLSPDF()"
                      class="btn btn-primary print-btn fontSize"
                      ><i class="fa fa-print"></i> Load Sheet</a
                    >
                  </div>
                  <div class="col-4">
                    <button
                      class="btn btn-primary print-btn fontSize"
                      data-toggle="modal"
                      data-target="#billsModal"
                    >
                      <i class="fa fa-print"></i> Bills
                    </button>
                  </div>
                  <div class="col-6 pl-5 pt-5">
                    <button
                      *ngIf="!loading"
                      class="btn btn-primary red-bg cancel_dispatch w-100"
                      (click)="revertDispatch()"
                    >
                      Reset
                    </button>
                    <button
                      *ngIf="loading"
                      type="submit"
                      class="btn btn-primary red-bg w-100 mr-2"
                      disabled
                    >
                      <div
                        class="spinner-border text-light"
                        role="status"
                      >
                        <span class="sr-only">Loading...</span>
                      </div>
                    </button>
                  </div>
                  <div class="col-6 pl-0 pr-5 pt-5">
                    <button
                      *ngIf="!loading"
                      class="btn btn-primary m-0 nextButton w-100"
                      (click)="completeDispatch()"
                    >
                      Complete
                    </button>
                    <button
                      *ngIf="loading"
                      type="submit"
                      class="btn btn-primary w-100 mr-2"
                      disabled
                    >
                      <div
                        class="spinner-border text-light"
                        role="status"
                      >
                        <span class="sr-only">Loading...</span>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="currentTab !== 5"
      class="col-md-12 pl-10 pr-10 text-center"
    >
      <div class="execFooter">
        <button
          (click)="currentTab = currentTab - 1; tabChanged()"
          [disabled]="
            currentTab === 1 ||
            currentTab === 5 ||
            loading ||
            savingOrder ||
            load.content[0].items.length > 0
          "
          type="submit"
          class="btn btn-primary m-0 mr-2"
        >
          Previous
        </button>
        <button
          *ngIf="currentTab !== 5 && currentTab !== 4"
          [disabled]="
            currentTab === 5 ||
            loading ||
            loadingProduct ||
            savingOrder ||
            !checkAllocationSuccess
          "
          (click)="currentTab = currentTab + 1; tabChanged()"
          type="submit"
          class="btn btn-primary m-0"
        >
          <div *ngIf="tabLoading" class="spinner-border" role="status">
            <span class="sr-only"></span>
          </div>
          {{ tabLoading ? "" : "Next" }}
        </button>
        <button
          *ngIf="currentTab === 4"
          [disabled]="loading || loadingProduct"
          (click)="openConfirmationModal()"
          type="submit"
          class="btn btn-primary m-0"
        >
          Next
        </button>
        <button
          style="display: none"
          id="open-create-load"
          data-toggle="modal"
          data-target="#create-load"
        >
          Open Modal
        </button>
      </div>
    </div>
  </div>

  <!-- Previous/Next Navigation Buttons - Global for all tabs -->
  <div class="flex justify-center gap-2 mt-4 mb-4 p-3 bg-[#f6f6f6] dark:bg-[#1a1a1a] rounded-lg mx-4">
    <button
      type="button"
      (click)="goToPreviousTab()"
      [disabled]="currentTab === 1"
      class="px-6 py-2 leading-none text-[15px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-primary hover:text-white focus:bg-primary focus:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
    >
      Previous
    </button>
    <button
      type="button"
      (click)="goToNextTab()"
      [disabled]="currentTab === 5"
      class="px-6 py-2 leading-none text-[15px] border border-primary rounded-[5px] font-primary bg-primary text-white hover:bg-primary hover:text-white focus:bg-primary focus:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
    >
      Next
    </button>
  </div>

  </div>
</div>


 



<div
  class="modal fade"
  id="order-del"
  tabindex="-1"
  role="dialog"
  aria-labelledby="orderLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content top-borderRed">
      <div class="modal-header">
        <h5 class="modal-title" id="orderLabel">Cancel Order <span></span></h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <p>Are you sure you want to cancel the order?</p>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary" (click)="cancelOrder()" style="font-size: 14px;padding: 8px 12px;letter-spacing: normal;">
          Cancel Without Allocation
        </button>
        <button type="button" class="btn btn-primary" (click)="cancelOrder(1)" style="font-size: 14px;padding: 8px 12px;letter-spacing: normal;">
          Cancel With Allocation
        </button>
        <button
          type="submit"
          id="close-del"
          class="btn btn-cancel"
          data-dismiss="modal"
          aria-label="Close"
          style="font-size: 14px;padding: 8px 16px;letter-spacing: normal;"
        >
          No
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="billsModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="billsModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content top_border">
      <div class="modal-header">
        <h5 class="modal-title" id="billsModalLabel">
          Please chose invoice date<span></span>
        </h5>
        <button
          type="button"
          id="close-bills"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-auto" style="padding-top: 6px; font-size: 14px">
            Select Date
          </div>
          <div class="col">
            <input
              type="date"
              id="invoice-date"
              [(ngModel)]="invoiceDate"
              class="form-control select-date"
              name="invoice-date"
              placeholder=""
            />
          </div>
          <div class="col-12">
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <h3 class="heading3">Select paper size for print</h3>
          </div>
        </div>
        <div class="row print-icon-div pb-0">
          <div class="col-6 pl-0">
            <a (click)="getBills('A4')"
              ><img class="print-icon" src="assets/images/a4.svg" alt="" />
              <strong>A4 Portrait Paper</strong></a
            >
          </div>
          <div class="col-6 pr-0">
            <a (click)="getBills('A5')"
              ><img class="print-icon" src="assets/images/a5.svg" alt="" />
              <strong>A5 Landscape Paper</strong></a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="create-load"
  tabindex="-1"
  role="dialog"
  aria-labelledby="create-loadLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content top-borderRed">
      <div class="modal-header">
        <h5 class="modal-title" id="create-loadLabel">
          Confirm Load <span></span>
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-md-12">
          <p>Are you sure you want to create New Load?</p>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button
          type="button"
          class="btn btn-primary"
          (click)="addCurrentLoad()"
        >
          Yes
        </button>
        <button
          type="submit"
          id="close-confirm-load"
          class="btn btn-cancel"
          data-dismiss="modal"
          aria-label="Close"
        >
          No
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Hold Order -->

<div
  class="modal fade"
  id="order-hold-model"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content top_border">
      <div class="modal-header">
        <h5 class="modal-title" id="holdOrderModalLabel"> Hold Order<span> </span>
        </h5>
        <button
          type="button"
          class="close dont-close-products"
          data-dismiss="modal"
          (click)="closeHoldOrderModal($event)"
          aria-label="Close"
        >
          <span class="dont-close-products" aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body AddDetailPR" style="font-size: 14px;">
        
        <div class="row">
          <div class="col-md-4 pt-7 mb-15">Hold Reason:</div>
          <div class="col-md-8 mb-15">
            <input
              type="text"
              class="form-control"
              placeholder="Reason"
              required
              [(ngModel)]="holdOrderParams.hold_reason"
              style="font-size: 13px"
            />
          </div>
        </div>
        <div class="row">
          <!-- <div class="col-md-12">
            <p>Are you sure you want to hold the order?</p>
          </div> -->
          <div class="col-md-4 PT-10">Delete Alloation:</div>
          <div class="col-md-8">
            <div class="custom-control custom-checkbox" style="line-height: 1.7;">
                  <input
                      type="checkbox"
                      class="custom-control-input"
                      id="deleteAllocationCheckbox"
                      [(ngModel)]="holdOrderParams.delete_allocation"
                  />
                  <label class="custom-control-label mt-2" for="deleteAllocationCheckbox">Yes</label>
              </div>
          </div>
        </div>
      </div>
      <div class="modal-footer border-0" style="background-color: #f6f6f6">
        <button
          type="button"
          class="btn btn-primary"
          (click)="holdOrder($event)"
          aria-label="Close"
        >
          Save
        </button>
        <button
          type="button"
          id="close-hold-model"
          class="btn btn-cancel"
          data-dismiss="modal"
          (click)="closeHoldOrderModal($event)"
          aria-label="Close"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
